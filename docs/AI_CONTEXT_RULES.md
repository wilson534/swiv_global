# 🤖 AI 开发助手上下文规则 / AI Context Management Rules

> **目的：** 确保 AI 助手（Claude、Cursor、Copilot 等）在整个开发过程中保持上下文连贯性，避免产生幻觉或不一致的建议。

---

## 📋 核心原则 / Core Principles

### 1. 文档优先 (Documentation First)
**规则：** 在回答任何问题或进行任何修改前，必须先查阅相关文档。

**查阅顺序：**
1. `docs/CONTEXT_LOG.md` - 检查是否有相关的历史决策
2. `docs/PRD_bilingual.md` - 确认产品需求和设计
3. `docs/TECH_STACK.md` - 确认技术栈和版本
4. `docs/PROJECT_STATUS.md` - 了解当前进度
5. `docs/DEVELOPMENT_ROADMAP.md` - 确认开发计划

**示例：**
```
❌ 错误方式：
用户: "PersonaNFT 应该怎么实现？"
AI: "我建议使用 ERC-721 标准..."

✅ 正确方式：
用户: "PersonaNFT 应该怎么实现？"
AI: [先读取 PRD_bilingual.md 第 5 节]
    "根据 PRD 第 5 节，PersonaNFT 应该使用 Anchor 框架实现，
     包含以下字段: owner, risk_profile, keywords_hash..."
```

---

### 2. 实事求是 (Stay Grounded)
**规则：** 不确定的信息必须明确指出，不能臆测或假设。

**禁止行为：**
- ❌ 假设未记录的技术决策
- ❌ 猜测未实现的功能
- ❌ 提供与文档不一致的建议
- ❌ 使用项目中不存在的依赖或 API

**正确做法：**
```
✅ "根据 TECH_STACK.md，我们使用 Anchor 0.29.0。"
✅ "CONTEXT_LOG.md 中尚未记录这个决策，建议先讨论并记录。"
✅ "PRD 中没有提到这个功能，是否需要补充到需求文档中？"
```

---

### 3. 及时更新 (Update Immediately)
**规则：** 每次重要决策或修改后，必须立即更新相关文档。

**需要更新的场景：**
- 技术选型变更 → 更新 `TECH_STACK.md`
- 新功能决策 → 更新 `CONTEXT_LOG.md`
- 任务完成 → 更新 `DEVELOPMENT_ROADMAP.md` 和 `PROJECT_STATUS.md`
- 遇到问题 → 记录到 `CONTEXT_LOG.md`
- 架构调整 → 更新 `PRD_bilingual.md` 和 `CONTEXT_LOG.md`

---

### 4. 版本一致性 (Version Consistency)
**规则：** 严格遵守文档中指定的版本号，不能随意升级或降级。

**版本清单：**
```
Solana CLI: 1.17+
Anchor: 0.29.0
Node.js: 18+
React Native: 0.72.6
Expo SDK: 49+
Next.js: 14+
```

**检查清单：**
- [ ] 使用任何依赖前先查阅 `TECH_STACK.md`
- [ ] 如需变更版本，先记录到 `CONTEXT_LOG.md`
- [ ] 更新 package.json 时确保版本匹配

---

## 🔍 每次对话前的检查清单 / Pre-Conversation Checklist

### AI 必须执行的步骤：

1. **📖 读取上下文**
   ```
   [ ] 打开 docs/CONTEXT_LOG.md
   [ ] 检查最近的开发日志
   [ ] 确认当前开发阶段
   ```

2. **🎯 确认问题范围**
   ```
   [ ] 问题涉及哪个模块？
   [ ] 是否有相关的现有决策？
   [ ] 需要查阅哪些文档？
   ```

3. **📚 查阅相关文档**
   ```
   [ ] 读取 PRD 相关章节
   [ ] 检查技术栈要求
   [ ] 确认当前进度状态
   ```

4. **💭 形成回答**
   ```
   [ ] 回答基于文档事实
   [ ] 引用具体文档位置
   [ ] 明确不确定的部分
   ```

5. **✏️ 更新文档（如需要）**
   ```
   [ ] 记录新决策到 CONTEXT_LOG
   [ ] 更新任务状态
   [ ] 更新进度指标
   ```

---

## 🚫 禁止行为清单 / Forbidden Actions

### 绝对不能做的事：

1. **❌ 凭记忆提供技术细节**
   - 错误: "我记得 PersonaNFT 有 5 个字段..."
   - 正确: [读取 PRD] "根据 PRD 第 5 节，PersonaNFT 有以下字段..."

2. **❌ 假设未记录的功能实现**
   - 错误: "聊天功能应该用 Socket.io..."
   - 正确: "PRD 中提到聊天系统，但具体实现方式尚未决策，建议讨论后记录。"

3. **❌ 使用与文档不一致的技术栈**
   - 错误: "我们用 Express.js 做 API..."
   - 正确: "根据 TECH_STACK.md，API 层使用 Next.js 14。"

4. **❌ 跳过文档更新**
   - 错误: [做完修改后不更新文档]
   - 正确: [修改代码 + 更新 CONTEXT_LOG + 更新 ROADMAP]

5. **❌ 提供过时的信息**
   - 错误: 基于旧版本文档的建议
   - 正确: 检查文档的"最后更新"时间，使用最新版本

---

## 📝 标准回答模板 / Standard Response Templates

### 模板 1: 技术实现问题

```markdown
根据项目文档：

**相关文档：** docs/PRD_bilingual.md 第 X 节
**当前状态：** [从 PROJECT_STATUS.md 获取]

**设计要求：**
[引用 PRD 中的具体内容]

**技术选型：**
[引用 TECH_STACK.md 中的具体内容]

**实现建议：**
[基于文档的具体建议]

**待确认事项：**
[列出文档中未明确的部分]
```

### 模板 2: 功能开发问题

```markdown
让我先检查项目状态：

**当前阶段：** [从 PROJECT_STATUS.md 读取]
**相关模块：** [确定模块]
**PRD 要求：** [引用具体章节]

**开发计划：**
1. [步骤 1]
2. [步骤 2]
3. [步骤 3]

**需要更新的文档：**
- [ ] CONTEXT_LOG.md - 记录决策
- [ ] PROJECT_STATUS.md - 更新进度
- [ ] DEVELOPMENT_ROADMAP.md - 标记任务完成
```

### 模板 3: 遇到不确定情况

```markdown
⚠️ 需要明确的信息：

**问题：** [描述不确定的部分]

**文档状态：**
- PRD: [是否有相关内容]
- TECH_STACK: [是否有技术说明]
- CONTEXT_LOG: [是否有历史决策]

**建议：**
1. [选项 1] - [优劣分析]
2. [选项 2] - [优劣分析]

**推荐方案：** [X]，因为 [原因]

**需要记录到：** docs/CONTEXT_LOG.md
```

---

## 🔄 文档同步流程 / Documentation Sync Flow

### 代码修改 → 文档更新流程

```
1. 修改代码
   ↓
2. 立即更新 CONTEXT_LOG.md
   - 记录修改内容
   - 记录决策原因
   - 更新时间戳
   ↓
3. 更新 PROJECT_STATUS.md
   - 标记任务完成
   - 更新进度百分比
   - 更新指标
   ↓
4. 更新 DEVELOPMENT_ROADMAP.md
   - 勾选完成任务
   - 调整后续计划（如需要）
   ↓
5. 如有架构变更，更新 PRD 或 TECH_STACK
   ↓
6. 提交 Git
   - 代码 + 文档一起提交
   - Commit message 明确说明变更
```

---

## 🎯 质量检查点 / Quality Checkpoints

### 每次回答前：
- [ ] 已读取相关文档
- [ ] 确认信息来源
- [ ] 检查版本一致性

### 每次修改后：
- [ ] 代码符合 PRD 要求
- [ ] 更新了相关文档
- [ ] 记录了决策过程

### 每天结束前：
- [ ] CONTEXT_LOG 是最新的
- [ ] PROJECT_STATUS 反映当天进度
- [ ] 没有未记录的重要决策

---

## 📊 文档健康度指标 / Documentation Health Metrics

### 健康的文档系统：
- ✅ CONTEXT_LOG 每天至少更新一次
- ✅ PROJECT_STATUS 的进度与实际一致
- ✅ 所有重要决策都有记录
- ✅ 技术栈版本清晰明确
- ✅ 文档之间没有矛盾

### 不健康的信号：
- ⚠️ 文档超过 2 天未更新
- ⚠️ 代码与文档不一致
- ⚠️ 重要决策未记录
- ⚠️ 使用未文档化的技术
- ⚠️ AI 给出矛盾的建议

---

## 🆘 问题处理指南 / Troubleshooting Guide

### 情况 1: 文档不明确
**现象：** PRD 中对某功能描述模糊
**处理：**
1. 明确指出模糊之处
2. 提供 2-3 个合理解释
3. 建议讨论并补充文档
4. 暂不实现该功能

### 情况 2: 文档冲突
**现象：** 不同文档中的描述矛盾
**处理：**
1. 列出所有冲突点
2. 分析每个版本的来源
3. 建议统一方案
4. 更新所有相关文档

### 情况 3: 技术栈变更
**现象：** 需要使用文档外的技术
**处理：**
1. 说明变更原因
2. 列出影响范围
3. 更新 TECH_STACK.md
4. 记录到 CONTEXT_LOG.md
5. 通知相关模块

---

## ✅ 本文档的使用规则

1. **所有 AI 助手都必须遵守本规则**
2. **用户可以引用本文档纠正 AI 的行为**
3. **本文档优先级高于 AI 的默认行为**
4. **如有疑问，优先保守（不做）而非激进（瞎做）**

---

**制定日期：** 2025-10-24
**最后更新：** 2025-10-24
**强制执行：** ✅ 是
**违反后果：** AI 的建议将被视为不可靠


